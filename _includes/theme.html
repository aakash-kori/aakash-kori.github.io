<li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" id="theme-btn">Themes</a>
    <ul class="dropdown-menu" id="theme-menu">
        {% for file in site.static_files %}
        {% if file.extname == ".css" %}
        <li class="dropdown-item theme-item" theme="{{site.baseurl}}{{file.path}}">{{file.basename}}</li>
        {% endif %}
        {% endfor %}
    </ul>
</li>
<script>
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(";");
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == " ") {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1000);
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path={{site.baseurl}}/";
    }

    function loadTheme() {
        // if theme cookie present use it to load theme
        var theme = getCookie("theme");
        var link = document.createElement("link");
        if (!theme) theme = "{{site.baseurl}}/css/bootstrap.css"
        link.href = theme;
        link.rel = "stylesheet";
        document.head.appendChild(link);

        // mark current theme as active
        var themeItems = document.getElementsByClassName("theme-item");
        Array.from(themeItems).forEach(element => {
            element.classList.remove("active")
            if (element.getAttribute("theme") == theme) {
                element.classList.add("active")
            }
        })

        // deselect dropdown
        var themeMenu = document.getElementById("theme-menu");
        themeMenu.classList.remove("show")
    }

    window.onload = function () {
        // add drop down event
        var themeBtn = document.getElementById("theme-btn");
        themeBtn.onclick = function (event) {
            var themeMenu = document.getElementById("theme-menu");
            themeMenu.classList.toggle("show")
            event.stopPropagation();
            event.cancelBubble = true;
        };

        // set cookie based on selection
        var y = document.getElementsByClassName("theme-item");
        Array.from(y).forEach(element => {
            element.onclick = (event) => {
                setCookie("theme", element.getAttribute("theme"), 365);
                loadTheme();
                event.stopPropagation();
                event.cancelBubble = true;
            };
        });
    };

    // collapse theme menu when clicking outside dialog box  
    document.addEventListener("click", function (event) {
        if (!event.target.matches('#theme-menu')) {
            var themeMenu = document.getElementById("theme-menu");
            if (themeMenu.classList.contains("show")) {
                themeMenu.classList.remove("show");
            }
        }
    })

    loadTheme();

</script>